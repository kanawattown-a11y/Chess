<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Chess Game</title>

  <!-- 1) jQuery قبل chessboard.js -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- 2) استخدم chess.js إصدار 0.12.1 من cdnjs -->
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.12.1/chess.min.js"
    integrity="sha512-rIescAjPgXHz3WaxrSjaOl5iZfvBVIehYe+EF+d+DAdFNgV10QBT8d5APBjcGFKES0iVUYjBilvpck7gOe7CLg=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script> :contentReference[oaicite:0]{index=0}

  <!-- 3) chessboard.js -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/css/chessboard.min.css"
  />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/js/chessboard.min.js"></script>
  
  <style>
    #board { width: 400px; margin: 20px auto; }
    #status { text-align: center; font-family: Arial, sans-serif; margin-top: 10px; }
  </style>
</head>
<body>
  <div id="board"></div>
  <div id="status"></div>

  <script>
    // تأكد إن المكتبة محمّلة
    if (typeof Chess === 'undefined') {
      document.body.innerHTML = '<p style="color:red; text-align:center;">خطأ: chess.js لم يُحمّل.</p>';
      throw new Error('chess.js not loaded');
    }

    const board = Chessboard('board', {
      draggable: true,
      position: 'start',
      onDragStart: (source, piece) => {
        if (game.game_over() ||
            (game.turn() === 'w' && piece.search(/^b/) !== -1) ||
            (game.turn() === 'b' && piece.search(/^w/) !== -1)) {
          return false;
        }
      },
      onDrop: (source, target) => {
        const move = game.move({ from: source, to: target, promotion: 'q' });
        if (!move) return 'snapback';
        updateStatus();
      },
      onSnapEnd: () => board.position(game.fen())
    });

    const game = new Chess();
    function updateStatus() {
      let status = '';
      const moveColor = game.turn() === 'w' ? 'White' : 'Black';
      if (game.in_checkmate()) {
        status = `Game over, ${moveColor} is in checkmate.`;
      } else if (game.in_draw()) {
        status = 'Game over, drawn position.';
      } else {
        status = `${moveColor} to move` + (game.in_check() ? `, ${moveColor} is in check` : '');
      }
      document.getElementById('status').textContent = status;
    }
    updateStatus();
  </script>
</body>
</html>
